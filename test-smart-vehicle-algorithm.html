<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¢Ø²Ù…Ø§ÛŒØ´ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <style>
        body {
            font-family: 'Tahoma', Arial, sans-serif;
            margin: 20px;
            direction: rtl;
            background-color: #f8fafc;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            background: #f8fafc;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #374151;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
        }
        .error {
            background: #fef2f2;
            border-color: #fecaca;
            color: #dc2626;
        }
        .selected-vehicle {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alternatives {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .alternative-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
        }
        .vehicle-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-top: 2px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸšš Ø¢Ø²Ù…Ø§ÛŒØ´ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
            <p>Ø³ÛŒØ³ØªÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ù‡ÛŒÙ†Ù‡ Ø®ÙˆØ¯Ø±Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ²Ù†ØŒ Ù…Ù‚ØµØ¯ Ùˆ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ù…Ø­ØµÙˆÙ„Ø§Øª</p>
        </div>

        <form id="vehicleForm">
            <div class="form-group">
                <label for="orderWeight">ğŸ‹ï¸ ÙˆØ²Ù† Ø³ÙØ§Ø±Ø´ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…) *</label>
                <input type="number" id="orderWeight" class="form-control" value="15" min="0.1" step="0.1" required>
                <small>ÙˆØ²Ù† Ú©Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´</small>
            </div>

            <div class="form-group">
                <label for="destinationCity">ğŸ™ï¸ Ø´Ù‡Ø± Ù…Ù‚ØµØ¯</label>
                <select id="destinationCity" class="form-control">
                    <option value="Ú©Ø±Ø¨Ù„Ø§">Ú©Ø±Ø¨Ù„Ø§</option>
                    <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                    <option value="Ø§Ø±Ø¨ÛŒÙ„">Ø§Ø±Ø¨ÛŒÙ„</option>
                    <option value="Ø¨ØµØ±Ù‡">Ø¨ØµØ±Ù‡</option>
                    <option value="Ù†Ø¬Ù">Ù†Ø¬Ù</option>
                    <option value="Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡">Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡</option>
                    <option value="Ø¯Ù‡ÙˆÚ©">Ø¯Ù‡ÙˆÚ©</option>
                    <option value="Ù…ÙˆØµÙ„">Ù…ÙˆØµÙ„</option>
                </select>
                <small>Ø´Ù‡Ø± Ù…Ù‚ØµØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ Ø­Ù…Ù„</small>
            </div>

            <div class="form-group">
                <label for="routeType">ğŸ›£ï¸ Ù†ÙˆØ¹ Ù…Ø³ÛŒØ± *</label>
                <select id="routeType" class="form-control" required>
                    <option value="urban">Ø´Ù‡Ø±ÛŒ (urban)</option>
                    <option value="interurban">Ø¨ÛŒÙ†â€ŒØ´Ù‡Ø±ÛŒ (interurban)</option>
                    <option value="highway">Ø¬Ø§Ø¯Ù‡â€ŒØ§ÛŒ (highway)</option>
                </select>
                <small>Ù†ÙˆØ¹ Ù…Ø³ÛŒØ± Ø­Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±ÙˆÛŒ Ù…Ù†Ø§Ø³Ø¨</small>
            </div>

            <div class="form-group">
                <label>âš ï¸ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ù…Ø­ØµÙˆÙ„Ø§Øª:</label>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="isHazardous"> 
                        ğŸ”¥ Ù…ÙˆØ§Ø¯ Ø®Ø·Ø±Ù†Ø§Ú© (Hazardous)
                    </label>
                    <label>
                        <input type="checkbox" id="isRefrigerated"> 
                        â„ï¸ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±Ø¯Ø®Ø§Ù†Ù‡ (Refrigerated)
                    </label>
                    <label>
                        <input type="checkbox" id="isFragile"> 
                        ğŸ“¦ Ø´Ú©Ø³ØªÙ†ÛŒ (Fragile)
                    </label>
                </div>
            </div>

            <button type="submit" class="btn" id="submitBtn">
                ğŸ” Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡
            </button>
        </form>

        <div id="results" style="display: none;"></div>
    </div>

    <script>
        const form = document.getElementById('vehicleForm');
        const resultsDiv = document.getElementById('results');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ...';
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><br>Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø±Ùˆ...</div>';

            try {
                const formData = {
                    orderWeightKg: parseFloat(document.getElementById('orderWeight').value),
                    destinationCity: document.getElementById('destinationCity').value,
                    routeType: document.getElementById('routeType').value,
                    isHazardous: document.getElementById('isHazardous').checked,
                    isRefrigerated: document.getElementById('isRefrigerated').checked,
                    isFragile: document.getElementById('isFragile').checked
                };

                console.log('Sending request:', formData);

                const response = await fetch('/api/logistics/select-optimal-vehicle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                console.log('Response:', data);

                if (data.success) {
                    displayResults(data);
                } else {
                    displayError(data.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ');
                }
            } catch (error) {
                console.error('Error:', error);
                displayError('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
            } finally {
                // Reset button
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'ğŸ” Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡';
            }
        });

        function displayResults(data) {
            const { selectedVehicle, alternatives, selectionCriteria } = data;
            
            let html = `
                <div class="selected-vehicle">
                    <h2>ğŸ† Ø®ÙˆØ¯Ø±Ùˆ Ù…Ù†ØªØ®Ø¨: ${selectedVehicle.vehicleName}</h2>
                    <div class="vehicle-info">
                        <div class="info-item">
                            <span>ğŸ’° Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„:</span>
                            <strong>${selectedVehicle.totalCost.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</strong>
                        </div>
                        <div class="info-item">
                            <span>ğŸ“Š Ø§Ù…ØªÛŒØ§Ø²:</span>
                            <strong>${selectedVehicle.score.toFixed(2)}</strong>
                        </div>
                        <div class="info-item">
                            <span>âš–ï¸ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¸Ø±ÙÛŒØª:</span>
                            <strong>${selectedVehicle.weightUtilization}%</strong>
                        </div>
                        <div class="info-item">
                            <span>ğŸ‹ï¸ Ø­Ø¯Ø§Ú©Ø«Ø± ÙˆØ²Ù†:</span>
                            <strong>${selectedVehicle.maxWeightKg} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</strong>
                        </div>
                        <div class="info-item">
                            <span>ğŸ“¦ Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…:</span>
                            <strong>${selectedVehicle.maxVolumeM3} Ù…ØªØ± Ù…Ú©Ø¹Ø¨</strong>
                        </div>
                        <div class="info-item">
                            <span>â›½ Ù…ØµØ±Ù Ø³ÙˆØ®Øª:</span>
                            <strong>${selectedVehicle.fuelConsumptionL100km} Ù„ÛŒØªØ±/100Ú©ÛŒÙ„ÙˆÙ…ØªØ±</strong>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <h3>ğŸ’¹ Ø¬Ø²Ø¦ÛŒØ§Øª Ù‡Ø²ÛŒÙ†Ù‡:</h3>
                        <div class="vehicle-info">
                            <div class="info-item">
                                <span>Ù‚ÛŒÙ…Øª Ù¾Ø§ÛŒÙ‡:</span>
                                <span>${selectedVehicle.basePrice.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</span>
                            </div>
                            <div class="info-item">
                                <span>Ù‡Ø²ÛŒÙ†Ù‡ ÙˆØ²Ù†:</span>
                                <span>${selectedVehicle.weightCost.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</span>
                            </div>
                            <div class="info-item">
                                <span>Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø³Ø§ÙØª:</span>
                                <span>${selectedVehicle.distanceCost.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</span>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>ğŸ“‹ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨:</h3>
                <div class="vehicle-info">
                    <div class="info-item">
                        <span>ÙˆØ²Ù† Ø³ÙØ§Ø±Ø´:</span>
                        <span>${selectionCriteria.orderWeightKg} Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…</span>
                    </div>
                    <div class="info-item">
                        <span>Ø´Ù‡Ø± Ù…Ù‚ØµØ¯:</span>
                        <span>${selectionCriteria.destinationCity}</span>
                    </div>
                    <div class="info-item">
                        <span>ÙØ§ØµÙ„Ù‡:</span>
                        <span>${selectionCriteria.distanceKm} Ú©ÛŒÙ„ÙˆÙ…ØªØ±</span>
                    </div>
                    <div class="info-item">
                        <span>Ù†ÙˆØ¹ Ù…Ø³ÛŒØ±:</span>
                        <span>${selectionCriteria.routeType}</span>
                    </div>
                    <div class="info-item">
                        <span>Ù…ÙˆØ§Ø¯ Ø®Ø·Ø±Ù†Ø§Ú©:</span>
                        <span>${selectionCriteria.isHazardous ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span>
                    </div>
                    <div class="info-item">
                        <span>Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø³Ø±Ø¯Ø®Ø§Ù†Ù‡:</span>
                        <span>${selectionCriteria.isRefrigerated ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span>
                    </div>
                    <div class="info-item">
                        <span>Ø´Ú©Ø³ØªÙ†ÛŒ:</span>
                        <span>${selectionCriteria.isFragile ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±'}</span>
                    </div>
                </div>
            `;

            if (alternatives && alternatives.length > 0) {
                html += `
                    <h3>ğŸ”„ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†:</h3>
                    <div class="alternatives">
                `;
                
                alternatives.forEach((vehicle, index) => {
                    html += `
                        <div class="alternative-card">
                            <h4>Ø±ØªØ¨Ù‡ ${index + 2}: ${vehicle.vehicleName}</h4>
                            <div class="vehicle-info">
                                <div class="info-item">
                                    <span>Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ù„:</span>
                                    <span>${vehicle.totalCost.toLocaleString()} Ø¯ÛŒÙ†Ø§Ø±</span>
                                </div>
                                <div class="info-item">
                                    <span>Ø§Ù…ØªÛŒØ§Ø²:</span>
                                    <span>${vehicle.score.toFixed(2)}</span>
                                </div>
                                <div class="info-item">
                                    <span>Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¸Ø±ÙÛŒØª:</span>
                                    <span>${vehicle.weightUtilization}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
            }

            resultsDiv.innerHTML = html;
            resultsDiv.className = 'results';
        }

        function displayError(message) {
            resultsDiv.innerHTML = `
                <div class="error">
                    <h3>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ø±Ùˆ</h3>
                    <p>${message}</p>
                    <p>Ù„Ø·ÙØ§Ù‹ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
                </div>
            `;
            resultsDiv.className = 'results error';
        }

        // Load test on page load
        window.addEventListener('load', () => {
            console.log('ğŸšš Smart Vehicle Algorithm Test Page Loaded');
            console.log('ğŸ”§ Available endpoints:');
            console.log('   POST /api/logistics/select-optimal-vehicle');
            console.log('ğŸ“‹ Test scenarios ready for execution');
        });
    </script>
</body>
</html>