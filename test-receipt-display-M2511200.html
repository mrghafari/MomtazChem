<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù†Ù…Ø§ÛŒØ´ ÙÛŒØ´ Ø³ÙØ§Ø±Ø´ M2511200</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .test-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .result {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { background-color: #d5f4e6; color: #27ae60; }
        .error { background-color: #fadbd8; color: #e74c3c; }
        .warning { background-color: #fcf3cf; color: #f39c12; }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        .info-box {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª ØªØ³Øª Ù†Ù…Ø§ÛŒØ´ ÙÛŒØ´ Ø³ÙØ§Ø±Ø´ M2511200</h1>
            <p>Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø´Ú©Ù„ "Ù‡ÛŒÚ† Ù…Ø¯Ø±Ú©ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡" Ø¯Ø± Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´</p>
        </div>

        <div class="info-box">
            <h3>ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´:</h3>
            <p><strong>Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´:</strong> M2511200</p>
            <p><strong>Ù…Ø´ØªØ±ÛŒ:</strong> ABAS ABASI (oilstar@hotmail.com)</p>
            <p><strong>Ù…Ø¨Ù„Øº:</strong> 211.33 IQD</p>
            <p><strong>Ù…Ø³ÛŒØ± ÙÛŒØ´:</strong> /uploads/receipts/receipt-1753278095535-893189175.png</p>
        </div>

        <div class="button-group">
            <button onclick="testFinancialOrders()">ğŸ” ØªØ³Øª API Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒ</button>
            <button onclick="testSpecificOrder()">ğŸ“‹ ØªØ³Øª Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ M2511200</button>
            <button onclick="testReceiptAccess()">ğŸ“„ ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙÛŒØ´</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬</button>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ” Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª API Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒ:</div>
            <div id="financial-orders-result" class="result">Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...</div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“‹ Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ M2511200:</div>
            <div id="specific-order-result" class="result">Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...</div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ“„ Ù†ØªÛŒØ¬Ù‡ ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙÛŒØ´:</div>
            <div id="receipt-access-result" class="result">Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...</div>
        </div>

        <div class="test-section">
            <div class="test-title">ğŸ”§ Ù†ØªÛŒØ¬Ù‡ Ø§ØµÙ„Ø§Ø­Ø§Øª Ø³ÛŒØ³ØªÙ…:</div>
            <div class="result success">
âœ… Ø§ØµÙ„Ø§Ø­ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯: order-management-storage.ts
â€¢ ØªØºÛŒÛŒØ± receiptUrl: paymentReceipts.receiptUrl Ø¨Ù‡ customerOrders.receiptPath
â€¢ Ø¯Ù„ÛŒÙ„: ÙÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ customer_orders Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ Ù†Ù‡ payment_receipts
â€¢ ØªØ£Ø«ÛŒØ±: ÙˆØ§Ø­Ø¯ Ù…Ø§Ù„ÛŒ Ø­Ø§Ù„Ø§ Ø¨Ø§ÛŒØ¯ ÙÛŒØ´ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡Ø¯
            </div>
        </div>

    </div>

    <script>
        async function testFinancialOrders() {
            const resultDiv = document.getElementById('financial-orders-result');
            resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';
            resultDiv.className = 'result';

            try {
                const response = await fetch('/api/financial/orders', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Find M2511200 order
                const order = data.orders?.find(o => o.orderNumber === 'M2511200');
                
                if (order) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… Ø³ÙØ§Ø±Ø´ M2511200 ÛŒØ§ÙØª Ø´Ø¯:
Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´: ${order.orderNumber}
ÙˆØ¶Ø¹ÛŒØª: ${order.currentStatus}
URL ÙÛŒØ´: ${order.paymentReceiptUrl || 'ÛŒØ§ÙØª Ù†Ø´Ø¯'}
ÙÛŒØ´ Ø¯Ø± receipt object: ${order.receipt ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª'}
Ù…Ø³ÛŒØ± ÙÛŒØ´: ${order.receipt?.url || 'ÛŒØ§ÙØª Ù†Ø´Ø¯'}`;
                } else {
                    resultDiv.className = 'result warning';
                    resultDiv.textContent = `âš ï¸ Ø³ÙØ§Ø±Ø´ M2511200 Ø¯Ø± Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.
ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø³ÙØ§Ø±Ø´Ø§Øª: ${data.orders?.length || 0}`;
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`;
            }
        }

        async function testSpecificOrder() {
            const resultDiv = document.getElementById('specific-order-result');
            resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';
            resultDiv.className = 'result';

            try {
                // Find order ID first
                const ordersResponse = await fetch('/api/financial/orders', {
                    credentials: 'include'
                });
                
                if (!ordersResponse.ok) {
                    throw new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª: ${ordersResponse.status}`);
                }
                
                const ordersData = await ordersResponse.json();
                const order = ordersData.orders?.find(o => o.orderNumber === 'M2511200');
                
                if (!order) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ Ø³ÙØ§Ø±Ø´ M2511200 Ø¯Ø± Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª ÛŒØ§ÙØª Ù†Ø´Ø¯';
                    return;
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = `âœ… Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ M2511200:
ID Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´: ${order.id}
ID Ø³ÙØ§Ø±Ø´ Ù…Ø´ØªØ±ÛŒ: ${order.customerOrderId}
Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´: ${order.orderNumber}
ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: ${order.currentStatus}
Ù…Ø¨Ù„Øº Ú©Ù„: ${order.totalAmount} ${order.currency}

ğŸ“„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙÛŒØ´:
â€¢ URL ÙÛŒØ´: ${order.paymentReceiptUrl || 'Ø®Ø§Ù„ÛŒ'}
â€¢ ÙÛŒØ´ Ø¯Ø± Receipt Object: ${order.receipt ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'Ø®Ø§Ù„ÛŒ'}
â€¢ Ù…Ø³ÛŒØ± ÙÛŒØ´: ${order.receipt?.url || 'Ø®Ø§Ù„ÛŒ'}
â€¢ Ù†Ø§Ù… ÙØ§ÛŒÙ„: ${order.receipt?.fileName || 'Ø®Ø§Ù„ÛŒ'}
â€¢ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„: ${order.receipt?.mimeType || 'Ø®Ø§Ù„ÛŒ'}

ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ:
â€¢ Ù†Ø§Ù…: ${order.customer?.firstName} ${order.customer?.lastName}
â€¢ Ø§ÛŒÙ…ÛŒÙ„: ${order.customer?.email}
â€¢ ØªÙ„ÙÙ†: ${order.customer?.phone}`;
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`;
            }
        }

        async function testReceiptAccess() {
            const resultDiv = document.getElementById('receipt-access-result');
            resultDiv.textContent = 'Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';
            resultDiv.className = 'result';

            try {
                // Test direct access to receipt file
                const receiptPath = '/uploads/receipts/receipt-1753278095535-893189175.png';
                
                const response = await fetch(receiptPath, {
                    method: 'HEAD',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `âœ… ÙÛŒØ´ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª:
Ù…Ø³ÛŒØ±: ${receiptPath}
ÙˆØ¶Ø¹ÛŒØª HTTP: ${response.status}
Ù†ÙˆØ¹ Ù…Ø­ØªÙˆØ§: ${response.headers.get('content-type') || 'Ù†Ø§Ù…Ø´Ø®Øµ'}
Ø§Ù†Ø¯Ø§Ø²Ù‡: ${response.headers.get('content-length') || 'Ù†Ø§Ù…Ø´Ø®Øµ'} Ø¨Ø§ÛŒØª`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ ÙÛŒØ´ Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†ÛŒØ³Øª:
Ù…Ø³ÛŒØ±: ${receiptPath}
ÙˆØ¶Ø¹ÛŒØª HTTP: ${response.status}
Ù¾ÛŒØ§Ù… Ø®Ø·Ø§: ${response.statusText}`;
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙÛŒØ´: ${error.message}`;
            }
        }

        function clearResults() {
            document.getElementById('financial-orders-result').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...';
            document.getElementById('financial-orders-result').className = 'result';
            document.getElementById('specific-order-result').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...';
            document.getElementById('specific-order-result').className = 'result';
            document.getElementById('receipt-access-result').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª...';
            document.getElementById('receipt-access-result').className = 'result';
        }

        // Auto-run all tests on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                testFinancialOrders();
                setTimeout(testSpecificOrder, 1000);
                setTimeout(testReceiptAccess, 2000);
            }, 500);
        });
    </script>
</body>
</html>