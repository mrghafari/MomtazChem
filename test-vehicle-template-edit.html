<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Vehicle Template Edit</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 10px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš› ØªØ³Øª Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø±Ùˆ</h1>
        <p>Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØ±Ù… Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø±Ùˆ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>

        <div class="test-section info">
            <h3>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø³ÛŒØ³ØªÙ…</h3>
            <div id="systemStatus">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ØªØ³Øª 1: Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø±Ùˆ</h3>
            <button class="btn-primary" onclick="testGetVehicleTemplates()">Ø¯Ø±ÛŒØ§ÙØª Ø§Ù„Ú¯ÙˆÙ‡Ø§</button>
            <div id="getTemplatesResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>âœï¸ ØªØ³Øª 2: Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÛŒ Ø®ÙˆØ¯Ø±Ùˆ (PUT Method)</h3>
            <p>Ø§ÛŒÙ† ØªØ³Øª Ø§Ø² Ù…ØªØ¯ PUT Ø¨Ø±Ø§ÛŒ Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÛŒ Ø®ÙˆØ¯Ø±Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
            <button class="btn-success" onclick="testEditVehicleTemplate()">ØªØ³Øª Ø§Ø¯ÛŒØª Ø¨Ø§ PUT</button>
            <div id="editTemplateResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ ØªØ³Øª 3: Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÛŒ Ø®ÙˆØ¯Ø±Ùˆ (PATCH Method)</h3>
            <p>Ø§ÛŒÙ† ØªØ³Øª Ø§Ø² Ù…ØªØ¯ PATCH Ø¨Ø±Ø§ÛŒ Ø§Ø¯ÛŒØª Ø§Ù„Ú¯ÙˆÛŒ Ø®ÙˆØ¯Ø±Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
            <button class="btn-success" onclick="testEditVehicleTemplatePatch()">ØªØ³Øª Ø§Ø¯ÛŒØª Ø¨Ø§ PATCH</button>
            <div id="editTemplatePatchResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ†• ØªØ³Øª 4: Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ú¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯</h3>
            <button class="btn-primary" onclick="testCreateVehicleTemplate()">Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ú¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯</button>
            <div id="createTemplateResult" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ Ù†ØªØ§ÛŒØ¬ Ú©Ù„ÛŒ</h3>
            <div id="overallResults">Ù‡Ù†ÙˆØ² ØªØ³ØªÛŒ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
        </div>
    </div>

    <script>
        let testResults = {
            getTemplates: false,
            editPUT: false,
            editPATCH: false,
            create: false
        };

        function updateOverallResults() {
            const resultsDiv = document.getElementById('overallResults');
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(r => r).length;
            
            resultsDiv.innerHTML = `
                <h4>Ù†ØªØ§ÛŒØ¬: ${passed}/${total} ØªØ³Øª Ù…ÙˆÙÙ‚</h4>
                <ul>
                    <li>Ø¯Ø±ÛŒØ§ÙØª Ø§Ù„Ú¯ÙˆÙ‡Ø§: ${testResults.getTemplates ? 'âœ…' : 'âŒ'}</li>
                    <li>Ø§Ø¯ÛŒØª Ø¨Ø§ PUT: ${testResults.editPUT ? 'âœ…' : 'âŒ'}</li>
                    <li>Ø§Ø¯ÛŒØª Ø¨Ø§ PATCH: ${testResults.editPATCH ? 'âœ…' : 'âŒ'}</li>
                    <li>Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ú¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯: ${testResults.create ? 'âœ…' : 'âŒ'}</li>
                </ul>
            `;
            
            if (passed === total) {
                resultsDiv.className = 'test-result success';
            } else if (passed > 0) {
                resultsDiv.className = 'test-result info';
            } else {
                resultsDiv.className = 'test-result error';
            }
        }

        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/logistics/test');
                const data = await response.json();
                
                document.getElementById('systemStatus').innerHTML = `
                    <div class="success" style="padding: 10px; border-radius: 4px;">
                        âœ… Ø³ÛŒØ³ØªÙ… Ø¢Ù†Ù„Ø§ÛŒÙ† Ø§Ø³Øª: ${data.message}
                    </div>
                `;
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = `
                    <div class="error" style="padding: 10px; border-radius: 4px;">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…: ${error.message}
                    </div>
                `;
            }
        }

        async function testGetVehicleTemplates() {
            try {
                const response = await fetch('/api/logistics/vehicle-templates', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (response.ok && data.success) {
                    testResults.getTemplates = true;
                    document.getElementById('getTemplatesResult').innerHTML = `
                        <div class="success">
                            âœ… Ù…ÙˆÙÙ‚: ${data.data?.length || 0} Ø§Ù„Ú¯Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯
                            <pre>${JSON.stringify(data.data?.slice(0, 2), null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ');
                }
            } catch (error) {
                testResults.getTemplates = false;
                document.getElementById('getTemplatesResult').innerHTML = `
                    <div class="error">
                        âŒ Ø®Ø·Ø§: ${error.message}
                    </div>
                `;
            }
            updateOverallResults();
        }

        async function testEditVehicleTemplate() {
            try {
                // First get templates to find an ID to edit
                const getResponse = await fetch('/api/logistics/vehicle-templates', {
                    credentials: 'include'
                });
                const getData = await getResponse.json();
                
                if (!getData.success || !getData.data?.length) {
                    throw new Error('Ù‡ÛŒÚ† Ø§Ù„Ú¯ÙˆÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¯ÛŒØª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
                
                const templateId = getData.data[0].id;
                const editData = {
                    name: "Ø§Ù„Ú¯ÙˆÛŒ ØªØ³Øª Ø§Ø¯ÛŒØª Ø´Ø¯Ù‡",
                    nameEn: "Test Edited Template",
                    maxWeightKg: "1500",
                    basePrice: "75000"
                };
                
                const response = await fetch(`/api/logistics/vehicle-templates/${templateId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(editData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    testResults.editPUT = true;
                    document.getElementById('editTemplateResult').innerHTML = `
                        <div class="success">
                            âœ… Ù…ÙˆÙÙ‚: Ø§Ù„Ú¯Ùˆ ${templateId} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¯ÛŒØª Ø´Ø¯ (PUT)
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
            } catch (error) {
                testResults.editPUT = false;
                document.getElementById('editTemplateResult').innerHTML = `
                    <div class="error">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¯ÛŒØª Ø¨Ø§ PUT: ${error.message}
                    </div>
                `;
            }
            updateOverallResults();
        }

        async function testEditVehicleTemplatePatch() {
            try {
                // First get templates to find an ID to edit
                const getResponse = await fetch('/api/logistics/vehicle-templates', {
                    credentials: 'include'
                });
                const getData = await getResponse.json();
                
                if (!getData.success || !getData.data?.length) {
                    throw new Error('Ù‡ÛŒÚ† Ø§Ù„Ú¯ÙˆÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¯ÛŒØª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
                
                const templateId = getData.data[0].id;
                const editData = {
                    name: "Ø§Ù„Ú¯ÙˆÛŒ ØªØ³Øª PATCH",
                    nameEn: "Test PATCH Template",
                    maxWeightKg: "2000",
                    basePrice: "85000"
                };
                
                const response = await fetch(`/api/logistics/vehicle-templates/${templateId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(editData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    testResults.editPATCH = true;
                    document.getElementById('editTemplatePatchResult').innerHTML = `
                        <div class="success">
                            âœ… Ù…ÙˆÙÙ‚: Ø§Ù„Ú¯Ùˆ ${templateId} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¯ÛŒØª Ø´Ø¯ (PATCH)
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
            } catch (error) {
                testResults.editPATCH = false;
                document.getElementById('editTemplatePatchResult').innerHTML = `
                    <div class="error">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¯ÛŒØª Ø¨Ø§ PATCH: ${error.message}
                    </div>
                `;
            }
            updateOverallResults();
        }

        async function testCreateVehicleTemplate() {
            try {
                const newTemplateData = {
                    name: "Ø§Ù„Ú¯ÙˆÛŒ ØªØ³Øª Ø¬Ø¯ÛŒØ¯",
                    nameEn: "New Test Template",
                    vehicleType: "van",
                    maxWeightKg: "1200",
                    maxVolumeM3: "8",
                    allowedRoutes: ["urban", "interurban"],
                    basePrice: "60000",
                    pricePerKm: "1200",
                    pricePerKg: "600",
                    supportsHazardous: false,
                    supportsRefrigerated: false,
                    supportsFragile: true,
                    averageSpeedKmh: "45",
                    fuelConsumptionL100km: "10",
                    isActive: true,
                    priority: 0
                };
                
                const response = await fetch('/api/logistics/vehicle-templates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(newTemplateData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    testResults.create = true;
                    document.getElementById('createTemplateResult').innerHTML = `
                        <div class="success">
                            âœ… Ù…ÙˆÙÙ‚: Ø§Ù„Ú¯ÙˆÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ ID ${data.data?.id} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
            } catch (error) {
                testResults.create = false;
                document.getElementById('createTemplateResult').innerHTML = `
                    <div class="error">
                        âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ú¯Ùˆ: ${error.message}
                    </div>
                `;
            }
            updateOverallResults();
        }

        // Run system status check on page load
        checkSystemStatus();
        updateOverallResults();
    </script>
</body>
</html>