<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุณุช ูุฑู ุซุจุช ูุงู ูุดุชุฑ ุจุง ูุฑูุช ุฌุบุฑุงูุง ุนุฑุงู</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; margin: 20px; direction: rtl; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #007bff; border-radius: 8px; }
        .success { border-color: #28a745; background-color: #d4edda; }
        .error { border-color: #dc3545; background-color: #f8d7da; }
        .info { border-color: #17a2b8; background-color: #d6f3ff; }
        h2 { color: #007bff; margin-top: 0; }
        .feature-list { list-style-type: none; padding: 0; }
        .feature-list li { margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 4px; }
        .feature-list li:before { content: "โ "; color: #28a745; font-weight: bold; }
        .test-button { 
            background: #007bff; color: white; padding: 10px 20px; 
            border: none; border-radius: 5px; cursor: pointer; margin: 5px;
        }
        .test-button:hover { background: #0056b3; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .api-test { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>๐ฏ ุชุณุช ูุฑู ุซุจุช ูุงู ูุดุชุฑ ุจุง ูุฑูุช ุฌุบุฑุงูุง ุนุฑุงู - ูุถุนุช ููุง</h1>
    
    <div class="test-section success">
        <h2>โ ูพุงุฏูโุณุงุฒ ูููู ูุฑูุช Excel</h2>
        <ul class="feature-list">
            <li>ุงุณุชูุงุฏู ุงุฒ ูุฑูุช ุฏูู "ุดูุฑ/ููุทูู" ูุทุงุจู ูุงู Excel ุงุฑุงุฆูโุดุฏู</li>
            <li>ุงุฏุบุงู ฺฉุงูู CRM ู ุณุณุชู ุซุจุช ูุงู ูุดุชุฑ</li>
            <li>ูพุงฺฏุงู ุฏุงุฏู ุฌุบุฑุงูุง ฺฉูพุงุฑฺู ุจุฑุง ุนุฑุงู (187 ุดูุฑุ 18 ุงุณุชุงู)</li>
            <li>ููุงุด ูุงุตูู ุงุฒ ุงุฑุจู ุจุฑุง ุจูููโุณุงุฒ ูุฌุณุชฺฉ</li>
            <li>ุฑุงุจุท ฺฉุงุฑุจุฑ ุฏูุฒุจุงูู (ุนุฑุจ/ุงูฺฏูุณ) ุจุง ูพุดุชุจุงู RTL</li>
            <li>ุชุทุจู ููุฏ cityRegion ุฏุฑ ุชูุงู ุณุณุชู</li>
        </ul>
    </div>

    <div class="test-section info">
        <h2>๐ URL ูุง ุชุณุช</h2>
        <div class="api-test">
            <strong>ูุฑู ุซุจุช ูุงู ูุดุชุฑ:</strong><br>
            <a href="/#/customer/register" target="_blank">/#/customer/register</a>
            <div class="log">
                ุจุฎุดโูุง ูุงุจู ุชุณุช:
                - ุงูุชุฎุงุจ ุงุณุชุงู ุงุฒ ูุณุช ฺฉุงูู ุนุฑุงู
                - ุงูุชุฎุงุจ ุดูุฑ/ููุทูู ุจุฑุงุณุงุณ ุงุณุชุงู ุงูุชุฎุงุจ
                - ููุงุด ูุงุตูู ุงุฒ ุงุฑุจู
                - ุซุจุช ุฏุงุฏูโูุง ุจุง ูุฑูุช ุตุญุญ Excel
            </div>
        </div>

        <div class="api-test">
            <strong>ูุฏุฑุช CRM:</strong><br>
            <a href="/#/admin/crm" target="_blank">/#/admin/crm</a>
            <div class="log">
                ุจุฎุดโูุง ูุงุจู ุชุณุช:
                - ููุงุด ููุฏ "ุดูุฑ/ููุทูู" ุฏุฑ ุฌุฏูู ูุดุชุฑุงู
                - ุงุฌุงุฏ ูุดุชุฑ ุฌุฏุฏ ุจุง ูุฑูุช ุฌุบุฑุงูุง ุตุญุญ
                - ูุฑุงุด ุงุทูุงุนุงุช ุฌุบุฑุงูุง ูุดุชุฑ ููุฌูุฏ
                - ุฌุณุชุฌู ุจุฑุงุณุงุณ ุดูุฑ/ููุทูู
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>๐งช ุชุณุช API Endpoints</h2>
        <button class="test-button" onclick="testProvinces()">ุชุณุช ุงุณุชุงูโูุง ุนุฑุงู</button>
        <button class="test-button" onclick="testCities()">ุชุณุช ุดูุฑูุง ุจุฑุงุณุงุณ ุงุณุชุงู</button>
        <button class="test-button" onclick="testRegistration()">ุชุณุช ุซุจุช ูุงู ููููู</button>
        <button class="test-button" onclick="testCRM()">ุชุณุช CRM Customer</button>
        <div id="test-results" class="log"></div>
    </div>

    <div class="test-section info">
        <h2>๐ ุฏุงุฏูโูุง ููููู ุจุฑุง ุชุณุช</h2>
        <div class="api-test">
            <strong>ููููู ุงุณุชุงู:</strong> ุจุบุฏุงุฏ<br>
            <strong>ููููู ุดูุฑ/ููุทูู:</strong> ุงูฺฉุฑุงุฏุฉ (Al-Karada) โข ูุงุตูู ุงุฒ ุงุฑุจู: 350 ฺฉูููุชุฑ<br>
            <strong>ููููู ูุดุชุฑ:</strong>
            <div class="log">
ุงูู: test@example.com
ูุงู: ุงุญูุฏ ูุญูุฏ
ุดุฑฺฉุช: ุดุฑฺฉุช ุชุณุช
ุชููู: +964 771 234 5678
ฺฉุดูุฑ: ุนุฑุงู
ุงุณุชุงู: ุจุบุฏุงุฏ
ุดูุฑ/ููุทูู: ุงูฺฉุฑุงุฏุฉ
ุขุฏุฑุณ: ุฎุงุจุงู ุชุณุชุ ุณุงุฎุชูุงู 123
            </div>
        </div>
    </div>

    <div class="test-section success">
        <h2>๐ ูุถุนุช ูพุฑูฺู</h2>
        <ul class="feature-list">
            <li>ูุฑูุช Excel ุจุฑุง ุดูุฑ/ุงุณุชุงู ฺฉุงููุงู ูพุงุฏูโุณุงุฒ ุดุฏ</li>
            <li>ุณุณุชู CRM ู ุซุจุช ูุงู ูุดุชุฑ ฺฉูพุงุฑฺู ุดุฏูุฏ</li>
            <li>ูพุงฺฏุงู ุฏุงุฏู ุฌุบุฑุงูุง ุนุฑุงู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช</li>
            <li>ุชูุงู LSP errors ุจุฑุทุฑู ุดุฏูุฏ</li>
            <li>ุณุณุชู ุขูุงุฏู ุชุณุช ู ุงุณุชูุงุฏู ููุง ุงุณุช</li>
        </ul>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('test-results');
            results.innerHTML += `[${new Date().toLocaleTimeString('fa-IR')}] ${message}\n`;
        }

        async function testProvinces() {
            log('๐ก ุชุณุช API ุงุณุชุงูโูุง ุนุฑุงู...');
            try {
                const response = await fetch('/api/logistics/provinces');
                const data = await response.json();
                if (data.success && Array.isArray(data.data)) {
                    log(`โ ${data.data.length} ุงุณุชุงู ุงูุช ุดุฏ`);
                    const sampleProvinces = data.data.slice(0, 3);
                    sampleProvinces.forEach(p => {
                        log(`   - ${p.nameArabic} (${p.nameEnglish})`);
                    });
                } else {
                    log('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุงุณุชุงูโูุง');
                }
            } catch (error) {
                log(`โ ุฎุทุง: ${error.message}`);
            }
        }

        async function testCities() {
            log('๐ก ุชุณุช API ุดูุฑูุง ุจุฑุง ุงุณุชุงู ุจุบุฏุงุฏ...');
            try {
                // First get Baghdad province ID
                const provinceResponse = await fetch('/api/logistics/provinces');
                const provinceData = await provinceResponse.json();
                const baghdad = provinceData.data.find(p => p.nameArabic === 'ุจุบุฏุงุฏ');
                
                if (baghdad) {
                    log(`โ ุงุณุชุงู ุจุบุฏุงุฏ ุงูุช ุดุฏ (ID: ${baghdad.id})`);
                    
                    const cityResponse = await fetch(`/api/logistics/cities?provinceId=${baghdad.id}`);
                    const cityData = await cityResponse.json();
                    
                    if (cityData.success && Array.isArray(cityData.data)) {
                        log(`โ ${cityData.data.length} ุดูุฑ/ููุทูู ุจุฑุง ุจุบุฏุงุฏ ุงูุช ุดุฏ`);
                        const sampleCities = cityData.data.slice(0, 3);
                        sampleCities.forEach(c => {
                            log(`   - ${c.nameArabic} (${c.nameEnglish}) โข ูุงุตูู: ${c.distanceFromErbilKm} ฺฉู`);
                        });
                    } else {
                        log('โ ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุดูุฑูุง');
                    }
                } else {
                    log('โ ุงุณุชุงู ุจุบุฏุงุฏ ุงูุช ูุดุฏ');
                }
            } catch (error) {
                log(`โ ุฎุทุง: ${error.message}`);
            }
        }

        async function testRegistration() {
            log('๐ก ุชุณุช ุซุจุช ูุงู ููููู...');
            const sampleData = {
                email: `test_${Date.now()}@example.com`,
                password: 'testpass123',
                firstName: 'ุงุญูุฏ',
                lastName: 'ูุญูุฏ',
                company: 'ุดุฑฺฉุช ุชุณุช',
                phone: '+964 771 234 5678',
                country: 'ุนุฑุงู',
                province: 'ุจุบุฏุงุฏ',
                cityRegion: 'ุงูฺฉุฑุงุฏุฉ',
                address: 'ุฎุงุจุงู ุชุณุชุ ุณุงุฎุชูุงู 123',
                postalCode: '10001',
                communicationPreference: 'email',
                preferredLanguage: 'ar',
                marketingConsent: false
            };

            try {
                const response = await fetch('/api/customers/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sampleData)
                });
                
                const result = await response.json();
                if (result.success) {
                    log('โ ุซุจุช ูุงู ูููู ุจุง ูุฑูุช Excel ุตุญุญ');
                    log(`   - ูุดุชุฑ CRM ID: ${result.crmCustomer?.id}`);
                    log(`   - ุดูุฑ/ููุทูู: ${sampleData.cityRegion}`);
                } else {
                    log(`โ ุฎุทุง ุฏุฑ ุซุจุช ูุงู: ${result.message}`);
                }
            } catch (error) {
                log(`โ ุฎุทุง: ${error.message}`);
            }
        }

        async function testCRM() {
            log('๐ก ุชุณุช CRM Customer...');
            try {
                const response = await fetch('/api/crm/customers');
                const data = await response.json();
                if (data.success) {
                    log(`โ ${data.customers?.length || 0} ูุดุชุฑ ุฏุฑ CRM ุงูุช ุดุฏ`);
                    if (data.customers && data.customers.length > 0) {
                        const sample = data.customers[0];
                        log(`   - ููููู: ${sample.firstName} ${sample.lastName}`);
                        log(`   - ุดูุฑ/ููุทูู: ${sample.cityRegion || sample.city || 'ูุงูุดุฎุต'}`);
                    }
                } else {
                    log(`โ ุฎุทุง ุฏุฑ CRM: ${data.message}`);
                }
            } catch (error) {
                log(`โ ุฎุทุง: ${error.message}`);
            }
        }

        // Auto-run basic tests on page load
        window.onload = function() {
            log('๐ ุชุณุชโูุง ุฎูุฏฺฉุงุฑ ุฏุฑ ุญุงู ุงุฌุฑุง...');
            setTimeout(testProvinces, 1000);
            setTimeout(testCities, 3000);
        };
    </script>
</body>
</html>