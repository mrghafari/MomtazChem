<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ø´Ù‡Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ†</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; margin: 20px; direction: rtl; }
        .test-section { margin: 20px 0; padding: 15px; border: 2px solid #28a745; border-radius: 8px; background: #d4edda; }
        h2 { color: #28a745; margin-top: 0; }
        .test-button { 
            background: #28a745; color: white; padding: 10px 20px; 
            border: none; border-radius: 5px; cursor: pointer; margin: 5px;
        }
        .test-button:hover { background: #1e7e34; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ØªØ³Øª Ø«Ø¨Øª Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ø´Ù‡Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ†</h1>
    
    <div class="test-section">
        <h2>âœ… Ù…Ø´Ú©Ù„ Ø¨Ø±Ø·Ø±Ù Ø´Ø¯ - Ù¾Ù†Ø¬ÙˆÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯</h2>
        <p>Ø´Ù‡Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ† Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨ÙˆØ¯ØŒ Ø­Ø§Ù„Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø§Ø³Øª:</p>
        <ul>
            <li><strong>Ø´Ù‡Ø±:</strong> Ù¾Ù†Ø¬ÙˆÛŒÙ† (Penjwin)</li>
            <li><strong>Ø§Ø³ØªØ§Ù†:</strong> Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡</li>
            <li><strong>ÙØ§ØµÙ„Ù‡ Ø§Ø² Ø§Ø±Ø¨ÛŒÙ„:</strong> 170 Ú©ÛŒÙ„ÙˆÙ…ØªØ±</li>
            <li><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> ÙØ¹Ø§Ù„ Ùˆ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ®Ø§Ø¨</li>
        </ul>
        
        <h3>ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ù„:</h3>
        <ul>
            <li>Ù…Ø¬Ù…ÙˆØ¹ Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ: 187 Ø´Ù‡Ø±</li>
            <li>Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡: 89 Ø´Ù‡Ø± (Ø´Ø§Ù…Ù„ Ù¾Ù†Ø¬ÙˆÛŒÙ†)</li>
            <li>Ù…Ø¬Ù…ÙˆØ¹ ÙØ¹Ù„ÛŒ: 276 Ø´Ù‡Ø±</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ£ÛŒÛŒØ¯</h2>
        <button class="test-button" onclick="testPenjwinAPI()">ØªØ³Øª API Ù¾Ù†Ø¬ÙˆÛŒÙ†</button>
        <button class="test-button" onclick="testSulaymaniyahCities()">ØªØ³Øª Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡</button>
        <button class="test-button" onclick="testCustomerRegistration()">ØªØ³Øª Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ù¾Ù†Ø¬ÙˆÛŒÙ†</button>
        <div id="test-results" class="log"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯</h2>
        <p>Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§ÛŒÙ† Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø±Ø§ ØªØ³Øª Ú©Ù†ÛŒØ¯:</p>
        <ul>
            <li><a href="/#/customer/register" target="_blank">ÙØ±Ù… Ø«Ø¨Øª Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ</a> - Ø§Ø³ØªØ§Ù† Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡ â†’ Ø´Ù‡Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ†</li>
            <li><a href="/#/admin/crm" target="_blank">Ù…Ø¯ÛŒØ±ÛŒØª CRM</a> - Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ù¾Ù†Ø¬ÙˆÛŒÙ†</li>
        </ul>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('test-results');
            const className = type === 'success' ? 'success' : (type === 'error' ? 'error' : '');
            results.innerHTML += `<div class="${className}">[${new Date().toLocaleTimeString('fa-IR')}] ${message}</div>`;
        }

        async function testPenjwinAPI() {
            log('ğŸ“¡ ØªØ³Øª API Ø¨Ø±Ø§ÛŒ Ø´Ù‡Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ†...');
            try {
                // First get Sulaymaniyah province ID
                const provinceResponse = await fetch('/api/logistics/provinces');
                const provinceData = await provinceResponse.json();
                const sulaymaniyah = provinceData.data.find(p => p.nameArabic === 'Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡');
                
                if (sulaymaniyah) {
                    log(`âœ… Ø§Ø³ØªØ§Ù† Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡ ÛŒØ§ÙØª Ø´Ø¯ (ID: ${sulaymaniyah.id})`, 'success');
                    
                    const cityResponse = await fetch(`/api/logistics/cities?provinceId=${sulaymaniyah.id}`);
                    const cityData = await cityResponse.json();
                    
                    const penjwin = cityData.data.find(c => c.nameArabic === 'Ù¾Ù†Ø¬ÙˆÛŒÙ†');
                    if (penjwin) {
                        log(`ğŸ‰ Ù¾Ù†Ø¬ÙˆÛŒÙ† ÛŒØ§ÙØª Ø´Ø¯! ID: ${penjwin.id}, ÙØ§ØµÙ„Ù‡: ${penjwin.distanceFromErbilKm} Ú©Ù…`, 'success');
                    } else {
                        log('âŒ Ù¾Ù†Ø¬ÙˆÛŒÙ† Ø¯Ø± Ù„ÛŒØ³Øª Ø´Ù‡Ø±Ù‡Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                    }
                } else {
                    log('âŒ Ø§Ø³ØªØ§Ù† Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        async function testSulaymaniyahCities() {
            log('ğŸ“¡ ØªØ³Øª ØªÙ…Ø§Ù… Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡...');
            try {
                const provinceResponse = await fetch('/api/logistics/provinces');
                const provinceData = await provinceResponse.json();
                const sulaymaniyah = provinceData.data.find(p => p.nameArabic === 'Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡');
                
                const cityResponse = await fetch(`/api/logistics/cities?provinceId=${sulaymaniyah.id}`);
                const cityData = await cityResponse.json();
                
                log(`âœ… ${cityData.data.length} Ø´Ù‡Ø± Ø¯Ø± Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡ ÛŒØ§ÙØª Ø´Ø¯:`, 'success');
                cityData.data.forEach(city => {
                    const highlight = city.nameArabic === 'Ù¾Ù†Ø¬ÙˆÛŒÙ†' ? ' â­' : '';
                    log(`   - ${city.nameArabic} (${city.distanceFromErbilKm} Ú©Ù…)${highlight}`);
                });
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        async function testCustomerRegistration() {
            log('ğŸ“¡ ØªØ³Øª Ø«Ø¨Øª Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ù¾Ù†Ø¬ÙˆÛŒÙ†...');
            const sampleData = {
                email: `penjwin_test_${Date.now()}@example.com`,
                password: 'testpass123',
                firstName: 'Ù…Ø­Ù…Ø¯',
                lastName: 'Ø§Ø­Ù…Ø¯ÛŒ',
                company: 'Ø´Ø±Ú©Øª Ù¾Ù†Ø¬ÙˆÛŒÙ†',
                phone: '+964 771 123 4567',
                country: 'Ø¹Ø±Ø§Ù‚',
                province: 'Ø³Ù„ÛŒÙ…Ø§Ù†ÛŒÙ‡',
                cityRegion: 'Ù¾Ù†Ø¬ÙˆÛŒÙ†',
                address: 'Ù¾Ù†Ø¬ÙˆÛŒÙ†ØŒ Ø®ÛŒØ§Ø¨Ø§Ù† Ø§ØµÙ„ÛŒØŒ Ù…Ù†Ø²Ù„ Ø´Ù…Ø§Ø±Ù‡ 10',
                postalCode: '46001',
                communicationPreference: 'email',
                preferredLanguage: 'ar',
                marketingConsent: false
            };

            try {
                const response = await fetch('/api/customers/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sampleData)
                });
                
                const result = await response.json();
                if (result.success) {
                    log('ğŸ‰ Ø«Ø¨Øª Ù†Ø§Ù… Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ù¾Ù†Ø¬ÙˆÛŒÙ† Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯!', 'success');
                    log(`   - Ù…Ø´ØªØ±ÛŒ CRM ID: ${result.crmCustomer?.id}`);
                    log(`   - Ø´Ù‡Ø±/Ù…Ù†Ø·Ù‚Ù‡: ${sampleData.cityRegion}`);
                    log(`   - Ø§Ø³ØªØ§Ù†: ${sampleData.province}`);
                } else {
                    log(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ù†Ø§Ù…: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }

        // Auto-run Penjwin test
        window.onload = function() {
            log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ù†Ø¬ÙˆÛŒÙ†...');
            setTimeout(testPenjwinAPI, 1000);
        };
    </script>
</body>
</html>