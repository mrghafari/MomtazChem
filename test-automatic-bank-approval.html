<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø³ÛŒØ³ØªÙ… ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; direction: rtl; text-align: right; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #2563eb; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; }
        h2 { color: #059669; margin-top: 30px; }
        .test-section { background: #f9fafb; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #2563eb; }
        .button { background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; }
        .button:hover { background: #1d4ed8; }
        .success { background: #10b981; }
        .success:hover { background: #059669; }
        .danger { background: #ef4444; }
        .danger:hover { background: #dc2626; }
        .warning { background: #f59e0b; }
        .warning:hover { background: #d97706; }
        .result { margin: 15px 0; padding: 15px; border-radius: 6px; }
        .result.success { background: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; }
        .result.error { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }
        .result.info { background: #eff6ff; color: #1e40af; border: 1px solid #bfdbfe; }
        .order-info { background: #fff; padding: 15px; margin: 10px 0; border-radius: 6px; border: 1px solid #e5e7eb; }
        .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-auto-approved { background: #d1fae5; color: #065f46; }
        .status-confirmed { background: #dbeafe; color: #1e40af; }
        .loading { display: none; margin-left: 10px; }
        .loading.show { display: inline; }
        .code { background: #f3f4f6; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; }
        .webhook-example { background: #fef7cd; padding: 15px; border-radius: 6px; border-left: 4px solid #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦ ØªØ³Øª Ø³ÛŒØ³ØªÙ… ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ</h1>
        
        <div class="test-section">
            <h2>ğŸ“‹ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø³ÛŒØ³ØªÙ…</h2>
            <p>Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÙØ§Ø±Ø´Ø§ØªÛŒ Ú©Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
            <ul>
                <li><strong>Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø±Ú¯Ø§Ù‡:</strong> Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨Ø§ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª "Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ" Ú©Ù‡ ÙˆØ¶Ø¹ÛŒØª "paid" Ø¯Ø§Ø±Ù†Ø¯</li>
                <li><strong>ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±:</strong> Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø®Ø§Ù„Øª Ú©Ø§Ø±Ø¨Ø± Ù…Ø§Ù„ÛŒ</li>
                <li><strong>Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø§Ù†Ø¨Ø§Ø±:</strong> Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ Ø¨Ø®Ø´ Ø§Ù†Ø¨Ø§Ø±Ø¯Ø§Ø±ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</li>
                <li><strong>Ø«Ø¨Øª ÙØ¹Ø§Ù„ÛŒØª:</strong> ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ù„Ø§Ú¯ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</h2>
            
            <div style="margin: 20px 0;">
                <h3>1. Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³ÙØ§Ø±Ø´Ø§Øª Ù…Ø¹Ù„Ù‚ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª ØªÙ…Ø§Ù… Ø³ÙØ§Ø±Ø´Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒØ´Ø¯Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù‡ Ùˆ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                <button class="button success" onclick="processPendingBankPayments()">
                    Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³ÙØ§Ø±Ø´Ø§Øª Ø¯Ø±Ú¯Ø§Ù‡
                </button>
                <span class="loading" id="processingLoader">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</span>
                <div id="processingResult"></div>
            </div>

            <div style="margin: 20px 0;">
                <h3>2. ØªØ³Øª Webhook Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                <p>Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ callback Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª</p>
                <input type="number" id="webhookOrderId" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´" style="padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px;">
                <button class="button warning" onclick="simulateWebhook()">
                    Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Webhook
                </button>
                <span class="loading" id="webhookLoader">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...</span>
                <div id="webhookResult"></div>
            </div>

            <div style="margin: 20px 0;">
                <h3>3. ØªØ£ÛŒÛŒØ¯ Ø¯Ø³ØªÛŒ ÛŒÚ© Ø³ÙØ§Ø±Ø´ Ø®Ø§Øµ</h3>
                <p>ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± ÛŒÚ© Ø³ÙØ§Ø±Ø´ Ù…Ø´Ø®Øµ</p>
                <input type="number" id="manualOrderId" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ Ù…Ø´ØªØ±ÛŒ" style="padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px;">
                <button class="button" onclick="manualAutoApprove()">
                    ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø³ØªÛŒ
                </button>
                <span class="loading" id="manualLoader">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</span>
                <div id="manualResult"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“¡ Ù…Ø«Ø§Ù„ Webhook</h2>
            <div class="webhook-example">
                <p><strong>Endpoint:</strong> <code>/api/payment/gateway/webhook</code></p>
                <p><strong>Method:</strong> POST</p>
                <p><strong>Ù†Ù…ÙˆÙ†Ù‡ JSON:</strong></p>
                <div class="code">
{
  "orderId": "123",
  "paymentStatus": "paid",
  "transactionId": "TXN123456789",
  "amount": "100000",
  "currency": "IQD"
}
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´</h2>
            <ul>
                <li><span class="status-badge status-pending">pending</span> - Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ</li>
                <li><span class="status-badge status-confirmed">confirmed</span> - ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</li>
                <li><span class="status-badge status-auto-approved">auto_approved</span> - ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ”„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</h2>
            <p>Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±Ø¯Ø§Ø²Ø´ØŒ Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ùˆ terminal Ø³Ø±ÙˆØ± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</p>
            <button class="button" onclick="openConsole()">
                Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø±
            </button>
        </div>
    </div>

    <script>
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        function showLoader(loaderId, show = true) {
            const loader = document.getElementById(loaderId);
            if (show) {
                loader.classList.add('show');
            } else {
                loader.classList.remove('show');
            }
        }

        async function processPendingBankPayments() {
            showLoader('processingLoader', true);
            showResult('processingResult', 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...', 'info');
            
            try {
                const response = await fetch('/api/admin/orders/process-pending-bank-payments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('processingResult', 
                        `âœ… Ù…ÙˆÙÙ‚ÛŒØª: ${data.data?.processed || 0} Ø³ÙØ§Ø±Ø´ Ø§Ø² ${data.data?.totalFound || 0} Ø³ÙØ§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯<br>${data.message}`, 
                        'success'
                    );
                } else {
                    showResult('processingResult', `âŒ Ø®Ø·Ø§: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('processingResult', `âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${error.message}`, 'error');
            } finally {
                showLoader('processingLoader', false);
            }
        }

        async function simulateWebhook() {
            const orderId = document.getElementById('webhookOrderId').value;
            if (!orderId) {
                showResult('webhookResult', 'âŒ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');
                return;
            }

            showLoader('webhookLoader', true);
            showResult('webhookResult', 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ webhook...', 'info');
            
            try {
                const webhookData = {
                    orderId: orderId,
                    paymentStatus: 'paid',
                    transactionId: `TXN${Date.now()}`,
                    amount: '100000',
                    currency: 'IQD'
                };

                const response = await fetch('/api/payment/gateway/webhook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(webhookData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('webhookResult', 
                        `âœ… Ù…ÙˆÙÙ‚ÛŒØª: ${data.message}<br>Ø³ÙØ§Ø±Ø´ ${orderId} Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ£ÛŒÛŒØ¯ Ø´Ø¯`, 
                        'success'
                    );
                } else {
                    showResult('webhookResult', `âŒ Ø®Ø·Ø§: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('webhookResult', `âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${error.message}`, 'error');
            } finally {
                showLoader('webhookLoader', false);
            }
        }

        async function manualAutoApprove() {
            const orderId = document.getElementById('manualOrderId').value;
            if (!orderId) {
                showResult('manualResult', 'âŒ Ø´Ù†Ø§Ø³Ù‡ Ø³ÙØ§Ø±Ø´ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª', 'error');
                return;
            }

            showLoader('manualLoader', true);
            showResult('manualResult', 'Ø¯Ø± Ø­Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±...', 'info');
            
            try {
                const response = await fetch('/api/admin/orders/auto-approve-bank-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerOrderId: parseInt(orderId)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult('manualResult', 
                        `âœ… Ù…ÙˆÙÙ‚ÛŒØª: ${data.message}<br>Ø³ÙØ§Ø±Ø´ ${orderId} Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ£ÛŒÛŒØ¯ Ø´Ø¯`, 
                        'success'
                    );
                } else {
                    showResult('manualResult', `âŒ Ø®Ø·Ø§: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult('manualResult', `âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${error.message}`, 'error');
            } finally {
                showLoader('manualLoader', false);
            }
        }

        function openConsole() {
            console.log('ğŸ¦ Ø³ÛŒØ³ØªÙ… ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ');
            console.log('Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±Ø¯Ø§Ø²Ø´ØŒ F12 Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯');
            alert('Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø§Ø² Ø´Ø¯. F12 Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯ ØªØ§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
        }

        // Auto-refresh every 30 seconds for live monitoring
        setInterval(() => {
            console.log('ğŸ”„ Auto-refresh: ', new Date().toLocaleString('fa-IR'));
        }, 30000);

        console.log('ğŸ¦ ØµÙØ­Ù‡ ØªØ³Øª Ø³ÛŒØ³ØªÙ… ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
    </script>
</body>
</html>